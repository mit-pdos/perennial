(* autogenerated from github.com/mit-pdos/gokv/memkv/lockservice *)
From Perennial.goose_lang Require Import prelude.
From Goose Require github_dot_com.mit_dash_pdos.gokv.connman.
From Goose Require github_dot_com.mit_dash_pdos.gokv.memkv.

From Perennial.goose_lang Require Import ffi.grove_prelude.

Definition LockClerk := struct.decl [
  "kv" :: ptrT
].

Definition LockClerk__Lock: val :=
  rec: "LockClerk__Lock" "ck" "key" :=
    let: "key" := ref_to uint64T "key" in
    let: "ck" := ref_to ptrT "ck" in
    (for: (λ: <>, (~ (memkv.KVClerk__ConditionalPut (struct.loadF LockClerk "kv" (![ptrT] "ck")) (![uint64T] "key") (NewSlice byteT #0) (NewSlice byteT #1)))); (λ: <>, Skip) := λ: <>,
      do:  #()).

Definition LockClerk__Unlock: val :=
  rec: "LockClerk__Unlock" "ck" "key" :=
    let: "key" := ref_to uint64T "key" in
    let: "ck" := ref_to ptrT "ck" in
    do:  memkv.KVClerk__Put (struct.loadF LockClerk "kv" (![ptrT] "ck")) (![uint64T] "key") (NewSlice byteT #0);;;
    do:  #().

Definition MakeLockClerk: val :=
  rec: "MakeLockClerk" "lockhost" "cm" :=
    let: "cm" := ref_to ptrT "cm" in
    let: "lockhost" := ref_to uint64T "lockhost" in
    return: (struct.new LockClerk [
       "kv" ::= memkv.MakeKVClerk (![uint64T] "lockhost") (![ptrT] "cm")
     ]);;;
    do:  #().

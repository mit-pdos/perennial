(* autogenerated from github.com/mit-pdos/gokv/lockservice *)
From Perennial.goose_lang Require Import prelude.
From Goose Require github_com.mit_pdos.gokv.kv.

Section code.
Context `{ext_ty: ext_types}.
Local Coercion Var' s: expr := Var s.

Definition LockClerk := struct.decl [
  "kv" :: ptrT
].

Definition LockClerk__Lock: val :=
  rec: "LockClerk__Lock" "ck" "key" :=
    Skip;;
    (for: (λ: <>, ((struct.loadF kv.Kv "ConditionalPut" (struct.loadF LockClerk "kv" "ck")) "key" #(str"") #(str"1")) ≠ #(str"ok")); (λ: <>, Skip) := λ: <>,
      Continue);;
    #().

Definition LockClerk__Unlock: val :=
  rec: "LockClerk__Unlock" "ck" "key" :=
    (struct.loadF kv.Kv "Put" (struct.loadF LockClerk "kv" "ck")) "key" #(str"");;
    #().

Definition MakeLockClerk: val :=
  rec: "MakeLockClerk" "kv" :=
    struct.new LockClerk [
      "kv" ::= "kv"
    ].

End code.

(* autogenerated by goose proofgen; do not modify *)
Require Export New.proof.proof_prelude.
Require Export New.generatedproof.github_com.goose_lang.primitive.
Require Export New.generatedproof.github_com.goose_lang.std.
Require Export New.generatedproof.github_com.sanjit_bhat.pav.cryptoffi.
Require Export New.generatedproof.github_com.sanjit_bhat.pav.cryptoutil.
Require Export New.generatedproof.github_com.tchajed.marshal.
Require Export New.generatedproof.github_com.sanjit_bhat.pav.safemarshal.
Require Export New.golang.theory.

Require Export New.code.github_com.sanjit_bhat.pav.merkle.

Set Default Proof Using "Type".

Module merkle.

(* type merkle.Tree *)
Module Tree.
Section def.
Context `{ffi_syntax}.
Record t := mk {
  root' : loc;
}.
End def.
End Tree.

Section instances.
Context `{ffi_syntax}.

Global Instance settable_Tree : Settable Tree.t :=
  settable! Tree.mk < Tree.root' >.
Global Instance into_val_Tree : IntoVal Tree.t :=
  {| to_val_def v :=
    struct.val_aux merkle.Tree [
    "root" ::= #(Tree.root' v)
    ]%struct
  |}.

Global Program Instance into_val_typed_Tree : IntoValTyped Tree.t merkle.Tree :=
{|
  default_val := Tree.mk (default_val _);
|}.
Next Obligation. solve_to_val_type. Qed.
Next Obligation. solve_zero_val. Qed.
Next Obligation. solve_to_val_inj. Qed.
Final Obligation. solve_decision. Qed.

Global Instance into_val_struct_field_Tree_root : IntoValStructField "root" merkle.Tree Tree.root'.
Proof. solve_into_val_struct_field. Qed.


Context `{!ffi_model, !ffi_semantics _ _, !ffi_interp _, !heapGS Σ}.
Global Instance wp_struct_make_Tree root':
  PureWp True
    (struct.make #merkle.Tree (alist_val [
      "root" ::= #root'
    ]))%struct
    #(Tree.mk root').
Proof. solve_struct_make_pure_wp. Qed.


Global Instance Tree_struct_fields_split dq l (v : Tree.t) :
  StructFieldsSplit dq l v (
    "Hroot" ∷ l ↦s[merkle.Tree :: "root"]{dq} v.(Tree.root')
  ).
Proof.
  rewrite /named.
  apply struct_fields_split_intro.
  unfold_typed_pointsto; split_pointsto_app.

  rewrite -!/(typed_pointsto_def _ _ _) -!typed_pointsto_unseal.

  solve_field_ref_f.
Qed.

End instances.

(* type merkle.node *)
Module node.
Section def.
Context `{ffi_syntax}.
Record t := mk {
  nodeTy' : w8;
  hash' : slice.t;
  child0' : loc;
  child1' : loc;
  label' : slice.t;
  val' : slice.t;
}.
End def.
End node.

Section instances.
Context `{ffi_syntax}.

Global Instance settable_node : Settable node.t :=
  settable! node.mk < node.nodeTy'; node.hash'; node.child0'; node.child1'; node.label'; node.val' >.
Global Instance into_val_node : IntoVal node.t :=
  {| to_val_def v :=
    struct.val_aux merkle.node [
    "nodeTy" ::= #(node.nodeTy' v);
    "hash" ::= #(node.hash' v);
    "child0" ::= #(node.child0' v);
    "child1" ::= #(node.child1' v);
    "label" ::= #(node.label' v);
    "val" ::= #(node.val' v)
    ]%struct
  |}.

Global Program Instance into_val_typed_node : IntoValTyped node.t merkle.node :=
{|
  default_val := node.mk (default_val _) (default_val _) (default_val _) (default_val _) (default_val _) (default_val _);
|}.
Next Obligation. solve_to_val_type. Qed.
Next Obligation. solve_zero_val. Qed.
Next Obligation. solve_to_val_inj. Qed.
Final Obligation. solve_decision. Qed.

Global Instance into_val_struct_field_node_nodeTy : IntoValStructField "nodeTy" merkle.node node.nodeTy'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_node_hash : IntoValStructField "hash" merkle.node node.hash'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_node_child0 : IntoValStructField "child0" merkle.node node.child0'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_node_child1 : IntoValStructField "child1" merkle.node node.child1'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_node_label : IntoValStructField "label" merkle.node node.label'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_node_val : IntoValStructField "val" merkle.node node.val'.
Proof. solve_into_val_struct_field. Qed.


Context `{!ffi_model, !ffi_semantics _ _, !ffi_interp _, !heapGS Σ}.
Global Instance wp_struct_make_node nodeTy' hash' child0' child1' label' val':
  PureWp True
    (struct.make #merkle.node (alist_val [
      "nodeTy" ::= #nodeTy';
      "hash" ::= #hash';
      "child0" ::= #child0';
      "child1" ::= #child1';
      "label" ::= #label';
      "val" ::= #val'
    ]))%struct
    #(node.mk nodeTy' hash' child0' child1' label' val').
Proof. solve_struct_make_pure_wp. Qed.


Global Instance node_struct_fields_split dq l (v : node.t) :
  StructFieldsSplit dq l v (
    "HnodeTy" ∷ l ↦s[merkle.node :: "nodeTy"]{dq} v.(node.nodeTy') ∗
    "Hhash" ∷ l ↦s[merkle.node :: "hash"]{dq} v.(node.hash') ∗
    "Hchild0" ∷ l ↦s[merkle.node :: "child0"]{dq} v.(node.child0') ∗
    "Hchild1" ∷ l ↦s[merkle.node :: "child1"]{dq} v.(node.child1') ∗
    "Hlabel" ∷ l ↦s[merkle.node :: "label"]{dq} v.(node.label') ∗
    "Hval" ∷ l ↦s[merkle.node :: "val"]{dq} v.(node.val')
  ).
Proof.
  rewrite /named.
  apply struct_fields_split_intro.
  unfold_typed_pointsto; split_pointsto_app.

  rewrite -!/(typed_pointsto_def _ _ _) -!typed_pointsto_unseal.
  simpl_one_flatten_struct (# (node.nodeTy' v)) merkle.node "nodeTy"%go.
  simpl_one_flatten_struct (# (node.hash' v)) merkle.node "hash"%go.
  simpl_one_flatten_struct (# (node.child0' v)) merkle.node "child0"%go.
  simpl_one_flatten_struct (# (node.child1' v)) merkle.node "child1"%go.
  simpl_one_flatten_struct (# (node.label' v)) merkle.node "label"%go.

  solve_field_ref_f.
Qed.

End instances.

(* type merkle.MerkleProof *)
Module MerkleProof.
Section def.
Context `{ffi_syntax}.
Record t := mk {
  Siblings' : slice.t;
  IsOtherLeaf' : bool;
  LeafLabel' : slice.t;
  LeafVal' : slice.t;
}.
End def.
End MerkleProof.

Section instances.
Context `{ffi_syntax}.

Global Instance settable_MerkleProof : Settable MerkleProof.t :=
  settable! MerkleProof.mk < MerkleProof.Siblings'; MerkleProof.IsOtherLeaf'; MerkleProof.LeafLabel'; MerkleProof.LeafVal' >.
Global Instance into_val_MerkleProof : IntoVal MerkleProof.t :=
  {| to_val_def v :=
    struct.val_aux merkle.MerkleProof [
    "Siblings" ::= #(MerkleProof.Siblings' v);
    "IsOtherLeaf" ::= #(MerkleProof.IsOtherLeaf' v);
    "LeafLabel" ::= #(MerkleProof.LeafLabel' v);
    "LeafVal" ::= #(MerkleProof.LeafVal' v)
    ]%struct
  |}.

Global Program Instance into_val_typed_MerkleProof : IntoValTyped MerkleProof.t merkle.MerkleProof :=
{|
  default_val := MerkleProof.mk (default_val _) (default_val _) (default_val _) (default_val _);
|}.
Next Obligation. solve_to_val_type. Qed.
Next Obligation. solve_zero_val. Qed.
Next Obligation. solve_to_val_inj. Qed.
Final Obligation. solve_decision. Qed.

Global Instance into_val_struct_field_MerkleProof_Siblings : IntoValStructField "Siblings" merkle.MerkleProof MerkleProof.Siblings'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_MerkleProof_IsOtherLeaf : IntoValStructField "IsOtherLeaf" merkle.MerkleProof MerkleProof.IsOtherLeaf'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_MerkleProof_LeafLabel : IntoValStructField "LeafLabel" merkle.MerkleProof MerkleProof.LeafLabel'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_MerkleProof_LeafVal : IntoValStructField "LeafVal" merkle.MerkleProof MerkleProof.LeafVal'.
Proof. solve_into_val_struct_field. Qed.


Context `{!ffi_model, !ffi_semantics _ _, !ffi_interp _, !heapGS Σ}.
Global Instance wp_struct_make_MerkleProof Siblings' IsOtherLeaf' LeafLabel' LeafVal':
  PureWp True
    (struct.make #merkle.MerkleProof (alist_val [
      "Siblings" ::= #Siblings';
      "IsOtherLeaf" ::= #IsOtherLeaf';
      "LeafLabel" ::= #LeafLabel';
      "LeafVal" ::= #LeafVal'
    ]))%struct
    #(MerkleProof.mk Siblings' IsOtherLeaf' LeafLabel' LeafVal').
Proof. solve_struct_make_pure_wp. Qed.


Global Instance MerkleProof_struct_fields_split dq l (v : MerkleProof.t) :
  StructFieldsSplit dq l v (
    "HSiblings" ∷ l ↦s[merkle.MerkleProof :: "Siblings"]{dq} v.(MerkleProof.Siblings') ∗
    "HIsOtherLeaf" ∷ l ↦s[merkle.MerkleProof :: "IsOtherLeaf"]{dq} v.(MerkleProof.IsOtherLeaf') ∗
    "HLeafLabel" ∷ l ↦s[merkle.MerkleProof :: "LeafLabel"]{dq} v.(MerkleProof.LeafLabel') ∗
    "HLeafVal" ∷ l ↦s[merkle.MerkleProof :: "LeafVal"]{dq} v.(MerkleProof.LeafVal')
  ).
Proof.
  rewrite /named.
  apply struct_fields_split_intro.
  unfold_typed_pointsto; split_pointsto_app.

  rewrite -!/(typed_pointsto_def _ _ _) -!typed_pointsto_unseal.
  simpl_one_flatten_struct (# (MerkleProof.Siblings' v)) merkle.MerkleProof "Siblings"%go.
  simpl_one_flatten_struct (# (MerkleProof.IsOtherLeaf' v)) merkle.MerkleProof "IsOtherLeaf"%go.
  simpl_one_flatten_struct (# (MerkleProof.LeafLabel' v)) merkle.MerkleProof "LeafLabel"%go.

  solve_field_ref_f.
Qed.

End instances.

Section names.

Class GlobalAddrs :=
{
  emptyHash : loc;
}.

Context `{!GlobalAddrs}.
Context `{hG: heapGS Σ, !ffi_semantics _ _}.
Context `{!goGlobalsGS Σ}.

Definition var_addrs : list (go_string * loc) := [
    ("emptyHash"%go, emptyHash)
  ].

Global Instance is_pkg_defined_instance : IsPkgDefined merkle :=
{|
  is_pkg_defined := is_global_definitions merkle var_addrs;
|}.

Definition own_allocated : iProp Σ :=
  "HemptyHash" ∷ emptyHash ↦ (default_val slice.t).

Global Instance wp_globals_get_emptyHash : 
  WpGlobalsGet merkle "emptyHash" emptyHash (is_pkg_defined merkle).
Proof. apply wp_globals_get'. reflexivity. Qed.

Global Instance wp_func_call_put :
  WpFuncCall merkle "put" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_find :
  WpFuncCall merkle "find" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_getProofLen :
  WpFuncCall merkle "getProofLen" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_VerifyMemb :
  WpFuncCall merkle "VerifyMemb" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_VerifyNonMemb :
  WpFuncCall merkle "VerifyNonMemb" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_VerifyUpdate :
  WpFuncCall merkle "VerifyUpdate" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_newShell :
  WpFuncCall merkle "newShell" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_proofToTree :
  WpFuncCall merkle "proofToTree" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_getNodeHash :
  WpFuncCall merkle "getNodeHash" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_compEmptyHash :
  WpFuncCall merkle "compEmptyHash" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_setLeafHash :
  WpFuncCall merkle "setLeafHash" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_compLeafHash :
  WpFuncCall merkle "compLeafHash" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_setInnerHash :
  WpFuncCall merkle "setInnerHash" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_compInnerHash :
  WpFuncCall merkle "compInnerHash" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_getChild :
  WpFuncCall merkle "getChild" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_getBit :
  WpFuncCall merkle "getBit" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_MerkleProofEncode :
  WpFuncCall merkle "MerkleProofEncode" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_func_call_MerkleProofDecode :
  WpFuncCall merkle "MerkleProofDecode" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_func_call'; reflexivity).

Global Instance wp_method_call_Tree'ptr_Digest :
  WpMethodCall merkle "Tree'ptr" "Digest" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_method_call'; reflexivity).

Global Instance wp_method_call_Tree'ptr_Prove :
  WpMethodCall merkle "Tree'ptr" "Prove" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_method_call'; reflexivity).

Global Instance wp_method_call_Tree'ptr_Put :
  WpMethodCall merkle "Tree'ptr" "Put" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_method_call'; reflexivity).

Global Instance wp_method_call_Tree'ptr_prove :
  WpMethodCall merkle "Tree'ptr" "prove" _ (is_pkg_defined merkle) :=
  ltac:(apply wp_method_call'; reflexivity).

End names.
End merkle.

(* autogenerated by goose proofgen; do not modify *)
Require Export New.proof.grove_prelude.
Require Export New.generatedproof.sync.
Require Export New.generatedproof.github_com.goose_lang.primitive.
Require Export New.generatedproof.github_com.mit_pdos.gokv.grove_ffi.
Require Export New.generatedproof.github_com.mit_pdos.gokv.reconnectclient.
Require Export New.generatedproof.github_com.mit_pdos.gokv.vrsm.configservice.config_gk.
Require Export New.generatedproof.github_com.mit_pdos.gokv.vrsm.replica.err_gk.
Require Export New.generatedproof.github_com.tchajed.marshal.
Require Export New.generatedproof.log.
Require Export New.generatedproof.github_com.goose_lang.std.
Require Export New.generatedproof.github_com.mit_pdos.gokv.urpc.
Require Export New.generatedproof.github_com.mit_pdos.gokv.vrsm.paxos.
Require Export New.golang.theory.

Require Export New.code.github_com.mit_pdos.gokv.vrsm.configservice.

Set Default Proof Using "Type".

Module configservice.

(* type configservice.Clerk *)
Module Clerk.
Section def.
Context `{ffi_syntax}.

Record t := mk {
  mu' : loc;
  cls' : slice.t;
  leader' : w64;
}.
End def.
End Clerk.

Section instances.
Context `{ffi_syntax}.
#[local] Transparent configservice.Clerk.
#[local] Typeclasses Transparent configservice.Clerk.

Global Instance Clerk_wf : struct.Wf configservice.Clerk.
Proof. apply _. Qed.

Global Instance settable_Clerk : Settable Clerk.t :=
  settable! Clerk.mk < Clerk.mu'; Clerk.cls'; Clerk.leader' >.
Global Instance into_val_Clerk : IntoVal Clerk.t :=
  {| to_val_def v :=
    struct.val_aux configservice.Clerk [
    "mu" ::= #(Clerk.mu' v);
    "cls" ::= #(Clerk.cls' v);
    "leader" ::= #(Clerk.leader' v)
    ]%struct
  |}.

Global Program Instance into_val_typed_Clerk : IntoValTyped Clerk.t configservice.Clerk :=
{|
  default_val := Clerk.mk (default_val _) (default_val _) (default_val _);
|}.
Next Obligation. solve_to_val_type. Qed.
Next Obligation. solve_zero_val. Qed.
Next Obligation. solve_to_val_inj. Qed.
Final Obligation. solve_decision. Qed.

Global Instance into_val_struct_field_Clerk_mu : IntoValStructField "mu" configservice.Clerk Clerk.mu'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_Clerk_cls : IntoValStructField "cls" configservice.Clerk Clerk.cls'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_Clerk_leader : IntoValStructField "leader" configservice.Clerk Clerk.leader'.
Proof. solve_into_val_struct_field. Qed.


Context `{!ffi_model, !ffi_semantics _ _, !ffi_interp _, !heapGS Σ}.


Global Instance Clerk_struct_fields_split dq l (v : Clerk.t) :
  StructFieldsSplit dq l v (
    "Hmu" ∷ l ↦s[configservice.Clerk :: "mu"]{dq} v.(Clerk.mu') ∗
    "Hcls" ∷ l ↦s[configservice.Clerk :: "cls"]{dq} v.(Clerk.cls') ∗
    "Hleader" ∷ l ↦s[configservice.Clerk :: "leader"]{dq} v.(Clerk.leader')
  ).
Proof.
  rewrite /named.
  apply struct_fields_split_intro.
  unfold_typed_pointsto; split_pointsto_app.

  rewrite -!/(typed_pointsto_def _ _ _) -!typed_pointsto_unseal.
  simpl_one_flatten_struct (# (Clerk.mu' v)) (configservice.Clerk) "mu"%go.
  simpl_one_flatten_struct (# (Clerk.cls' v)) (configservice.Clerk) "cls"%go.

  solve_field_ref_f.
Qed.

End instances.

(* type configservice.state *)
Module state.
Section def.
Context `{ffi_syntax}.

Record t := mk {
  epoch' : w64;
  reservedEpoch' : w64;
  leaseExpiration' : w64;
  wantLeaseToExpire' : bool;
  config' : config_gk.S.t;
}.
End def.
End state.

Section instances.
Context `{ffi_syntax}.
#[local] Transparent configservice.state.
#[local] Typeclasses Transparent configservice.state.

Global Instance state_wf : struct.Wf configservice.state.
Proof. apply _. Qed.

Global Instance settable_state : Settable state.t :=
  settable! state.mk < state.epoch'; state.reservedEpoch'; state.leaseExpiration'; state.wantLeaseToExpire'; state.config' >.
Global Instance into_val_state : IntoVal state.t :=
  {| to_val_def v :=
    struct.val_aux configservice.state [
    "epoch" ::= #(state.epoch' v);
    "reservedEpoch" ::= #(state.reservedEpoch' v);
    "leaseExpiration" ::= #(state.leaseExpiration' v);
    "wantLeaseToExpire" ::= #(state.wantLeaseToExpire' v);
    "config" ::= #(state.config' v)
    ]%struct
  |}.

Global Program Instance into_val_typed_state : IntoValTyped state.t configservice.state :=
{|
  default_val := state.mk (default_val _) (default_val _) (default_val _) (default_val _) (default_val _);
|}.
Next Obligation. solve_to_val_type. Qed.
Next Obligation. solve_zero_val. Qed.
Next Obligation. solve_to_val_inj. Qed.
Final Obligation. solve_decision. Qed.

Global Instance into_val_struct_field_state_epoch : IntoValStructField "epoch" configservice.state state.epoch'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_state_reservedEpoch : IntoValStructField "reservedEpoch" configservice.state state.reservedEpoch'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_state_leaseExpiration : IntoValStructField "leaseExpiration" configservice.state state.leaseExpiration'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_state_wantLeaseToExpire : IntoValStructField "wantLeaseToExpire" configservice.state state.wantLeaseToExpire'.
Proof. solve_into_val_struct_field. Qed.

Global Instance into_val_struct_field_state_config : IntoValStructField "config" configservice.state state.config'.
Proof. solve_into_val_struct_field. Qed.


Context `{!ffi_model, !ffi_semantics _ _, !ffi_interp _, !heapGS Σ}.


Global Instance state_struct_fields_split dq l (v : state.t) :
  StructFieldsSplit dq l v (
    "Hepoch" ∷ l ↦s[configservice.state :: "epoch"]{dq} v.(state.epoch') ∗
    "HreservedEpoch" ∷ l ↦s[configservice.state :: "reservedEpoch"]{dq} v.(state.reservedEpoch') ∗
    "HleaseExpiration" ∷ l ↦s[configservice.state :: "leaseExpiration"]{dq} v.(state.leaseExpiration') ∗
    "HwantLeaseToExpire" ∷ l ↦s[configservice.state :: "wantLeaseToExpire"]{dq} v.(state.wantLeaseToExpire') ∗
    "Hconfig" ∷ l ↦s[configservice.state :: "config"]{dq} v.(state.config')
  ).
Proof.
  rewrite /named.
  apply struct_fields_split_intro.
  unfold_typed_pointsto; split_pointsto_app.

  rewrite -!/(typed_pointsto_def _ _ _) -!typed_pointsto_unseal.
  simpl_one_flatten_struct (# (state.epoch' v)) (configservice.state) "epoch"%go.
  simpl_one_flatten_struct (# (state.reservedEpoch' v)) (configservice.state) "reservedEpoch"%go.
  simpl_one_flatten_struct (# (state.leaseExpiration' v)) (configservice.state) "leaseExpiration"%go.
  simpl_one_flatten_struct (# (state.wantLeaseToExpire' v)) (configservice.state) "wantLeaseToExpire"%go.

  solve_field_ref_f.
Qed.

End instances.

(* type configservice.Server *)
Module Server.
Section def.
Context `{ffi_syntax}.

Record t := mk {
  s' : loc;
}.
End def.
End Server.

Section instances.
Context `{ffi_syntax}.
#[local] Transparent configservice.Server.
#[local] Typeclasses Transparent configservice.Server.

Global Instance Server_wf : struct.Wf configservice.Server.
Proof. apply _. Qed.

Global Instance settable_Server : Settable Server.t :=
  settable! Server.mk < Server.s' >.
Global Instance into_val_Server : IntoVal Server.t :=
  {| to_val_def v :=
    struct.val_aux configservice.Server [
    "s" ::= #(Server.s' v)
    ]%struct
  |}.

Global Program Instance into_val_typed_Server : IntoValTyped Server.t configservice.Server :=
{|
  default_val := Server.mk (default_val _);
|}.
Next Obligation. solve_to_val_type. Qed.
Next Obligation. solve_zero_val. Qed.
Next Obligation. solve_to_val_inj. Qed.
Final Obligation. solve_decision. Qed.

Global Instance into_val_struct_field_Server_s : IntoValStructField "s" configservice.Server Server.s'.
Proof. solve_into_val_struct_field. Qed.


Context `{!ffi_model, !ffi_semantics _ _, !ffi_interp _, !heapGS Σ}.


Global Instance Server_struct_fields_split dq l (v : Server.t) :
  StructFieldsSplit dq l v (
    "Hs" ∷ l ↦s[configservice.Server :: "s"]{dq} v.(Server.s')
  ).
Proof.
  rewrite /named.
  apply struct_fields_split_intro.
  unfold_typed_pointsto; split_pointsto_app.

  rewrite -!/(typed_pointsto_def _ _ _) -!typed_pointsto_unseal.

  solve_field_ref_f.
Qed.

End instances.

Section names.

Context `{!heapGS Σ}.
Context `{!globalsGS Σ}.
Context {go_ctx : GoContext}.
#[local] Transparent is_pkg_defined is_pkg_defined_pure.

Global Instance is_pkg_defined_pure_configservice : IsPkgDefinedPure configservice :=
  {|
    is_pkg_defined_pure_def go_ctx :=
      is_pkg_defined_pure_single configservice ∧
      is_pkg_defined_pure code.sync.sync ∧
      is_pkg_defined_pure code.github_com.goose_lang.primitive.primitive ∧
      is_pkg_defined_pure code.github_com.mit_pdos.gokv.grove_ffi.grove_ffi ∧
      is_pkg_defined_pure code.github_com.mit_pdos.gokv.reconnectclient.reconnectclient ∧
      is_pkg_defined_pure code.github_com.mit_pdos.gokv.vrsm.configservice.config_gk.config_gk ∧
      is_pkg_defined_pure code.github_com.mit_pdos.gokv.vrsm.replica.err_gk.err_gk ∧
      is_pkg_defined_pure code.github_com.tchajed.marshal.marshal ∧
      is_pkg_defined_pure code.log.log ∧
      is_pkg_defined_pure code.github_com.goose_lang.std.std ∧
      is_pkg_defined_pure code.github_com.mit_pdos.gokv.urpc.urpc ∧
      is_pkg_defined_pure code.github_com.mit_pdos.gokv.vrsm.paxos.paxos;
  |}.

#[local] Transparent is_pkg_defined_single is_pkg_defined_pure_single.
Global Program Instance is_pkg_defined_configservice : IsPkgDefined configservice :=
  {|
    is_pkg_defined_def go_ctx :=
      (is_pkg_defined_single configservice ∗
       is_pkg_defined code.sync.sync ∗
       is_pkg_defined code.github_com.goose_lang.primitive.primitive ∗
       is_pkg_defined code.github_com.mit_pdos.gokv.grove_ffi.grove_ffi ∗
       is_pkg_defined code.github_com.mit_pdos.gokv.reconnectclient.reconnectclient ∗
       is_pkg_defined code.github_com.mit_pdos.gokv.vrsm.configservice.config_gk.config_gk ∗
       is_pkg_defined code.github_com.mit_pdos.gokv.vrsm.replica.err_gk.err_gk ∗
       is_pkg_defined code.github_com.tchajed.marshal.marshal ∗
       is_pkg_defined code.log.log ∗
       is_pkg_defined code.github_com.goose_lang.std.std ∗
       is_pkg_defined code.github_com.mit_pdos.gokv.urpc.urpc ∗
       is_pkg_defined code.github_com.mit_pdos.gokv.vrsm.paxos.paxos)%I
  |}.
Final Obligation. iIntros. iFrame "#%". Qed.
#[local] Opaque is_pkg_defined_single is_pkg_defined_pure_single.

Global Instance wp_func_call_MakeClerk :
  WpFuncCall configservice.MakeClerk _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_func_call).

Global Instance wp_func_call_encodeState :
  WpFuncCall configservice.encodeState _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_func_call).

Global Instance wp_func_call_decodeState :
  WpFuncCall configservice.decodeState _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_func_call).

Global Instance wp_func_call_makeServer :
  WpFuncCall configservice.makeServer _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_func_call).

Global Instance wp_func_call_StartServer :
  WpFuncCall configservice.StartServer _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_func_call).

Global Instance wp_method_call_Clerk'ptr_GetConfig :
  WpMethodCall (ptrT.id configservice.Clerk.id) "GetConfig" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Clerk'ptr_GetLease :
  WpMethodCall (ptrT.id configservice.Clerk.id) "GetLease" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Clerk'ptr_ReserveEpochAndGetConfig :
  WpMethodCall (ptrT.id configservice.Clerk.id) "ReserveEpochAndGetConfig" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Clerk'ptr_TryWriteConfig :
  WpMethodCall (ptrT.id configservice.Clerk.id) "TryWriteConfig" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Server'ptr_GetConfig :
  WpMethodCall (ptrT.id configservice.Server.id) "GetConfig" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Server'ptr_GetLease :
  WpMethodCall (ptrT.id configservice.Server.id) "GetLease" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Server'ptr_ReserveEpochAndGetConfig :
  WpMethodCall (ptrT.id configservice.Server.id) "ReserveEpochAndGetConfig" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Server'ptr_TryWriteConfig :
  WpMethodCall (ptrT.id configservice.Server.id) "TryWriteConfig" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

Global Instance wp_method_call_Server'ptr_tryAcquire :
  WpMethodCall (ptrT.id configservice.Server.id) "tryAcquire" _ (is_pkg_defined configservice) :=
  ltac:(solve_wp_method_call).

End names.
End configservice.

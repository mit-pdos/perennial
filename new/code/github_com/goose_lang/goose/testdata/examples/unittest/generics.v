(* autogenerated from github.com/goose-lang/goose/testdata/examples/unittest/generics *)
Require Export New.code.github_com.goose_lang.goose.testdata.examples.unittest.generics.helpers.

From New.golang Require Import defn.
Definition generics : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics".

Module generics.

Section code.
Context `{ffi_syntax}.


Definition UnderlyingSlice : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.UnderlyingSlice"%go.

(* go: constraints.go:3:6 *)
Definition UnderlyingSliceⁱᵐᵖˡ : val :=
  λ: "T" "s",
    exception_do (let: "s" := (GoAllocValue T "s") in
    return: (let: "$a0" := (![T] "s") in
     slice.len "$a0")).

Definition Clone : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.Clone"%go.

(* Clone copies a generic slice.

   Slightly simplified from [slices.Clone].

   go: constraints.go:10:6 *)
Definition Cloneⁱᵐᵖˡ : val :=
  λ: "S" "E" "s",
    exception_do (let: "s" := (GoAllocValue S "s") in
    return: (let: "$a0" := #slice.nil in
     let: "$a1" := (![S] "s") in
     (slice.append E) "$a0" "$a1")).

Definition Boxⁱᵐᵖˡ (T : go.type)  : go.type := go.StructType [
  (go.FieldDecl "Value"%go T)
].

Definition BoxGet : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.BoxGet"%go.

(* BoxGet is a function getter (rather than a method)

   go: generics.go:13:6 *)
Definition BoxGetⁱᵐᵖˡ : val :=
  λ: "T" "b",
    exception_do (let: "b" := (GoAllocValue (Box T) "b") in
    return: (![T] (struct.field_ref Box #"Value"%go "b"))).

Definition BoxGet2 : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.BoxGet2"%go.

(* go: generics.go:17:6 *)
Definition BoxGet2ⁱᵐᵖˡ : val :=
  λ: "b",
    exception_do (let: "b" := (GoAllocValue (Box go.uint64) "b") in
    return: (![go.uint64] (struct.field_ref Box #"Value"%go "b"))).

(* go: generics.go:21:17 *)
Definition Box__Getⁱᵐᵖˡ : val :=
  λ: "b" "T" <>,
    exception_do (let: "b" := (GoAllocValue (Box T) "b") in
    return: (![T] (struct.field_ref Box #"Value"%go "b"))).

Definition makeGenericBox : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.makeGenericBox"%go.

(* go: generics.go:25:6 *)
Definition makeGenericBoxⁱᵐᵖˡ : val :=
  λ: "T" "value",
    exception_do (let: "value" := (GoAllocValue T "value") in
    return: (let: "$Value" := (![T] "value") in
     struct.make (Box T) [{
       "Value" ::= "$Value"
     }])).

Definition makeBox : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.makeBox"%go.

(* go: generics.go:29:6 *)
Definition makeBoxⁱᵐᵖˡ : val :=
  λ: <>,
    exception_do (return: (let: "$Value" := #(W64 42) in
     struct.make (Box go.uint64) [{
       "Value" ::= "$Value"
     }])).

Definition useBoxGet : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.useBoxGet"%go.

(* go: generics.go:34:6 *)
Definition useBoxGetⁱᵐᵖˡ : val :=
  λ: <>,
    exception_do (let: "x" := (GoAlloc (Box go.uint64) #()) in
    let: "$r0" := (let: "$a0" := #(W64 42) in
    ((FuncResolve makeGenericBox #()) go.uint64) "$a0") in
    do:  ("x" <-[Box go.uint64] "$r0");;;
    return: ((MethodResolve (Box go.uint64) Get #() (![Box go.uint64] "x") go.uint64) #())).

Definition Containerⁱᵐᵖˡ (T : go.type)  : go.type := go.StructType [
  (go.FieldDecl "X"%go T);
  (go.FieldDecl "Y"%go go.MapType go.int T);
  (go.FieldDecl "Z"%go go.PointerType T);
  (go.FieldDecl "W"%go go.uint64)
].

Definition useContainer : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.useContainer"%go.

(* go: generics.go:47:6 *)
Definition useContainerⁱᵐᵖˡ : val :=
  λ: <>,
    exception_do (let: "container" := (GoAlloc (Container go.uint64) #()) in
    let: "$r0" := (let: "$X" := #(W64 1) in
    let: "$Y" := ((let: "$v0" := #(W64 2) in
    let: "$k0" := #(W64 1) in
    map.literal go.int go.uint64 [map.kv_entry "$k0" "$v0"])) in
    let: "$Z" := (GoAlloc go.uint64 #()) in
    let: "$W" := #(W64 3) in
    struct.make (Container go.uint64) [{
      "X" ::= "$X";
      "Y" ::= "$Y";
      "Z" ::= "$Z";
      "W" ::= "$W"
    }]) in
    do:  ("container" <-[Container go.uint64] "$r0");;;
    let: "$r0" := #(W64 2) in
    do:  ((struct.field_ref Container #"X"%go "container") <-[go.uint64] "$r0");;;
    let: "$r0" := #(W64 3) in
    do:  (map.insert (![go.MapType go.int go.uint64] (struct.field_ref Container #"Y"%go "container")) #(W64 2) "$r0");;;
    let: "$r0" := (GoAlloc go.uint64 #()) in
    do:  ((struct.field_ref Container #"Z"%go "container") <-[go.PointerType go.uint64] "$r0");;;
    let: "$r0" := #(W64 4) in
    do:  ((struct.field_ref Container #"W"%go "container") <-[go.uint64] "$r0");;;
    return: #()).

Definition UseContainerⁱᵐᵖˡ  : go.type := go.StructType [
  (go.FieldDecl "X"%go Container go.uint64)
].

Definition OnlyIndirectⁱᵐᵖˡ (T : go.type)  : go.type := go.StructType [
  (go.FieldDecl "X"%go go.SliceType T);
  (go.FieldDecl "Y"%go go.PointerType T)
].

Definition MultiParamⁱᵐᵖˡ (A : go.type) (B : go.type)  : go.type := go.StructType [
  (go.FieldDecl "Y"%go B);
  (go.FieldDecl "X"%go A)
].

Definition useMultiParam : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.useMultiParam"%go.

(* go: generics.go:75:6 *)
Definition useMultiParamⁱᵐᵖˡ : val :=
  λ: <>,
    exception_do (let: "mp" := (GoAlloc (MultiParam go.uint64 go.bool) #()) in
    let: "$r0" := (let: "$Y" := #true in
    let: "$X" := #(W64 1) in
    struct.make (MultiParam go.uint64 go.bool) [{
      "Y" ::= "$Y";
      "X" ::= "$X"
    }]) in
    do:  ("mp" <-[MultiParam go.uint64 go.bool] "$r0");;;
    let: "$r0" := #(W64 2) in
    do:  ((struct.field_ref MultiParam #"X"%go "mp") <-[go.uint64] "$r0");;;
    return: #()).

Definition swapMultiParam : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.swapMultiParam"%go.

(* go: generics.go:80:6 *)
Definition swapMultiParamⁱᵐᵖˡ : val :=
  λ: "A" "p",
    exception_do (let: "p" := (GoAllocValue (go.PointerType (MultiParam A A)) "p") in
    let: "temp" := (GoAlloc A #()) in
    let: "$r0" := (![A] (struct.field_ref MultiParam #"X"%go (![go.PointerType (MultiParam A A)] "p"))) in
    do:  ("temp" <-[A] "$r0");;;
    let: "$r0" := (![A] (struct.field_ref MultiParam #"Y"%go (![go.PointerType (MultiParam A A)] "p"))) in
    do:  ((struct.field_ref MultiParam #"X"%go (![go.PointerType (MultiParam A A)] "p")) <-[A] "$r0");;;
    let: "$r0" := (![A] "temp") in
    do:  ((struct.field_ref MultiParam #"Y"%go (![go.PointerType (MultiParam A A)] "p")) <-[A] "$r0");;;
    return: #()).

Definition multiParamFunc : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.multiParamFunc"%go.

(* go: generics.go:86:6 *)
Definition multiParamFuncⁱᵐᵖˡ : val :=
  λ: "A" "B" "x" "b",
    exception_do (let: "b" := (GoAllocValue B "b") in
    let: "x" := (GoAllocValue A "x") in
    return: ((let: "$sl0" := (![B] "b") in
     slice.literal B ["$sl0"]))).

Definition useMultiParamFunc : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.useMultiParamFunc"%go.

(* go: generics.go:90:6 *)
Definition useMultiParamFuncⁱᵐᵖˡ : val :=
  λ: <>,
    exception_do (do:  (let: "$a0" := #(W64 1) in
    let: "$a1" := #true in
    ((FuncResolve multiParamFunc #()) go.uint64 go.bool) "$a0" "$a1");;;
    return: (#());;;
    return: #()).

Definition useAnyPointer : go_string := "github.com/goose-lang/goose/testdata/examples/unittest/generics.useAnyPointer"%go.

(* go: generics.go:96:6 *)
Definition useAnyPointerⁱᵐᵖˡ : val :=
  λ: <>,
    exception_do (let: "x" := (GoAlloc go.uint64 #()) in
    do:  (let: "$a0" := "x" in
    (FuncResolve helpers.AnyPointer #() go.uint64) "$a0");;;
    return: #()).

Definition vars' : list (go_string * go.type) := [].

Definition functions' : list (go_string * val) := [(UnderlyingSlice, UnderlyingSliceⁱᵐᵖˡ); (Clone, Cloneⁱᵐᵖˡ); (BoxGet, BoxGetⁱᵐᵖˡ); (BoxGet2, BoxGet2ⁱᵐᵖˡ); (makeGenericBox, makeGenericBoxⁱᵐᵖˡ); (makeBox, makeBoxⁱᵐᵖˡ); (useBoxGet, useBoxGetⁱᵐᵖˡ); (useContainer, useContainerⁱᵐᵖˡ); (useMultiParam, useMultiParamⁱᵐᵖˡ); (swapMultiParam, swapMultiParamⁱᵐᵖˡ); (multiParamFunc, multiParamFuncⁱᵐᵖˡ); (useMultiParamFunc, useMultiParamFuncⁱᵐᵖˡ); (useAnyPointer, useAnyPointerⁱᵐᵖˡ)].

Definition msets' : list (go_string * (list (go_string * val))) := [(Box, [("Get"%go, Box__Getⁱᵐᵖˡ)]); (go.PointerType Box, [("Get"%go, (λ: "$r",
                 MethodResolve Box Get #() (![Box] "$r")
                 )%V)]); (Container, []); (go.PointerType Container, []); (UseContainer, []); (go.PointerType UseContainer, []); (OnlyIndirect, []); (go.PointerType OnlyIndirect, []); (MultiParam, []); (go.PointerType MultiParam, [])].

#[global] Instance info' : PkgInfo generics.generics :=
  {|
    pkg_vars := vars';
    pkg_functions := functions';
    pkg_msets := msets';
    pkg_imported_pkgs := [code.github_com.goose_lang.goose.testdata.examples.unittest.generics.helpers.helpers];
  |}.

Definition initialize' : val :=
  λ: <>,
    package.init #generics.generics (λ: <>,
      exception_do (do:  (helpers.initialize' #());;;
      do:  (package.alloc generics.generics #()))
      ).

End code.
End generics.
